<!doctype html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout.html}">
<head><title>Active Game</title>
    <script>
        function init_buttons() {
            // get an array of 1 and 0 to decide which button to enable or not. depending on the current state.
            const acbe = [[${active_command_buttons_enabled}]];
            const haszeus = [[${has_zeus}]];
            // console.log('Current State: [[${current_state}]])');
            // console.log(acbe);
            // 0, -0, and NaN turn into false; other numbers turn into true.
            $('#btn_prepare').prop('disabled', !acbe[0]); // there is no enabled
            $('#btn_ready').prop('disabled', !acbe[1]);
            $('#btn_reset').prop('disabled', !acbe[2]);
            $('#btn_run').prop('disabled', !acbe[3]);
            $('#btn_pause').prop('disabled', !acbe[4]);
            $('#btn_resume').prop('disabled', !acbe[5]);
            $('#btn_continue').prop('disabled', !acbe[6]);
            $('#btn_game_over').prop('disabled', !acbe[7]);
            // zeus
            $('#btn_zeus').prop('disabled', !haszeus || sessionStorage.getItem("state") !== 'RUNNING');
        }

        function goto_zeus() {
            const mode = '[[${mode}]]';
            const base_url = window.location.origin + '/ui/zeus/base';
            location.href = base_url + '?' + jQuery.param({'id': sessionStorage.getItem('gameid')});
        }

    </script>
</head>

<body>

<section layout:fragment="content">
    <div id="game_control" class="bg-white sticky-top">
        <div class="row">
            <button id="btn_prepare"
                    th:onclick="post_rest('game/process', {'id':sessionStorage.getItem('gameid'),'message':[[${T(de.flashheart.rlg.commander.games.Game)._msg_PREPARE}]]});"
                    class="btn btn-outline-primary col-sm-auto me-1"><span
                    class="bi bi-rocket-takeoff-fill">&nbsp;Prepare</span></button>
            <button th:onclick="post_rest('game/process', {'id':sessionStorage.getItem('gameid'),'message':[[${T(de.flashheart.rlg.commander.games.Game)._msg_RESET}]]});"
                    class="btn btn-outline-warning  col-sm-auto me-1"><span class="bi bi-skip-backward-circle-fill">&nbsp;Reset</span>
            </button>
            <button id="btn_ready"
                    th:onclick="post_rest('game/process', {'id':sessionStorage.getItem('gameid'),'message':[[${T(de.flashheart.rlg.commander.games.Game)._msg_READY}]]});"
                    class="btn btn-outline-secondary  col-sm-auto me-1"><span
                    class="bi bi-hand-thumbs-up-fill">&nbsp;Ready</span></button>
            <button id="btn_run"
                    th:onclick="post_rest('game/process', {'id':sessionStorage.getItem('gameid'),'message':[[${T(de.flashheart.rlg.commander.games.Game)._msg_RUN}]]});"
                    class="btn btn-outline-success  col-sm-auto me-1"><span
                    class="bi bi-play-circle-fill">&nbsp;Run</span>
            </button>
            <button id="btn_pause"
                    th:onclick="post_rest('game/process', {'id':sessionStorage.getItem('gameid'),'message':[[${T(de.flashheart.rlg.commander.games.Game)._msg_PAUSE}]]});"
                    class="btn btn-outline-secondary  col-sm-auto me-1"><span
                    class="bi bi-pause-circle-fill">&nbsp;Pause</span></button>
            <button id="btn_resume"
                    th:onclick="post_rest('game/process', {'id':sessionStorage.getItem('gameid'),'message':[[${T(de.flashheart.rlg.commander.games.Game)._msg_RESUME}]]});"
                    class="btn btn-outline-secondary  col-sm-auto me-1"><span class="bi bi-fast-forward-circle-fill">&nbsp;Resume</span>
            </button>
            <button id="btn_continue"
                    th:onclick="post_rest('game/process', {'id':sessionStorage.getItem('gameid'),'message':[[${T(de.flashheart.rlg.commander.games.Game)._msg_CONTINUE}]]});"
                    class="btn btn-outline-secondary  col-sm-auto me-1"><span class="bi bi-fast-forward-circle">&nbsp;Continue</span>
            </button>
            <button id="btn_game_over"
                    th:onclick="post_rest('game/process', {'id':sessionStorage.getItem('gameid'),'message':[[${T(de.flashheart.rlg.commander.games.Game)._msg_GAME_OVER}]]});"
                    class="btn btn-outline-secondary me-auto col-sm-auto"><span class="bi bi-stop-circle-fill">&nbsp;Game Over</span>
            </button>
            <button id="btn_zeus" onclick="goto_zeus()" class="btn btn-outline-danger col-sm-auto"><span
                    class="bi bi-sliders">&nbsp;Zeus Admin</span>
            </button>
            <!--            <a onclick="goto_zeus()" class="btn btn-outline-danger col-sm-auto" id="btn_zeus"  role="button" aria-pressed="true"><span class="bi bi-stop-circle-fill">&nbsp;Zeus</span></a>-->
        </div>
    </div>
    <script>init_buttons();</script>

    <h1 th:text="${comment}"></h1>
    <h2 th:if="${match_length != null && remaining != null}"
        th:text="'Match length: '+${match_length}+', remaining time: '+${remaining}"></h2>

    <section layout:fragment="score">
    </section>

    <div th:if="${red_spawns != null && blue_spawns != null}">
        <h2>Number of Respawns</h2>
        <p class="text-danger" th:text="'Team Red:&nbsp;' + ${red_spawns}"></p>
        <p class="text-primary" th:text="'Team Blue:&nbsp;' + ${blue_spawns}"></p>
    </div>

    <div class="row" th:unless="${classname eq 'empty'}">
        <div class="col-8">
            <h2>Events</h2>
            <table class="table table-striped table-sm">
                <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>Event</th>
                    <th>State</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="event : ${events}">
                    <td th:text="${event.value0}"></td>
                    <td th:text="${event.value1}"></td>
                    <td th:text="${event.value2}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</section>


</body>
</html>
